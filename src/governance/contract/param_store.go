package contract

import "common"

/*
**  Creator: pxf
**  Date: 2018/4/25 下午5:59
**  Description: 
*/

const (
	PARAM_STORE_CODE = `606060405234156200001057600080fd5b60036000816200002191906200020d565b506040805190810160405280600181526020017f31000000000000000000000000000000000000000000000000000000000000008152506000808154811015156200006857fe5b906000526020600020906004020160000160000190805190602001906200009192919062000242565b506000806000815481101515620000a457fe5b906000526020600020906004020160030181620000c29190620002c9565b506040805190810160405280600181526020017f3500000000000000000000000000000000000000000000000000000000000000815250600060018154811015156200010a57fe5b906000526020600020906004020160000160000190805190602001906200013392919062000242565b5060008060018154811015156200014657fe5b906000526020600020906004020160030181620001649190620002c9565b506040805190810160405280600181526020017f320000000000000000000000000000000000000000000000000000000000000081525060006002815481101515620001ac57fe5b90600052602060002090600402016000016000019080519060200190620001d592919062000242565b506000806002815481101515620001e857fe5b906000526020600020906004020160030181620002069190620002c9565b506200045f565b8154818355818115116200023d576004028160040283600052602060002091820191016200023c9190620002fe565b5b505050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200028557805160ff1916838001178555620002b6565b82800160010185558215620002b6579182015b82811115620002b557825182559160200191906001019062000298565b5b509050620002c591906200036e565b5090565b815481835581811511620002f957600302816003028360005260206000209182019101620002f8919062000396565b5b505050565b6200036b91905b808211156200036757600080820160008082016000620003269190620003ed565b60018201600090556002820160006101000a81549067ffffffffffffffff021916905550506003820160006200035d919062000439565b5060040162000305565b5090565b90565b6200039391905b808211156200038f57600081600090555060010162000375565b5090565b90565b620003ea91905b80821115620003e65760008082016000620003b99190620003ed565b60018201600090556002820160006101000a81549067ffffffffffffffff0219169055506003016200039d565b5090565b90565b50805460018160011615610100020316600290046000825580601f1062000415575062000436565b601f0160209004906000526020600020908101906200043591906200036e565b5b50565b50805460008255600302906000526020600020908101906200045c919062000396565b50565b610dba806200046f6000396000f30060606040526004361061006d576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680632504d824146100725780632fdddb1c1461014d5780637acbfd5d14610176578063a95e699d1461025d578063c7cb2e5c146102a6575b600080fd5b341561007d57600080fd5b6100a8600480803563ffffffff1690602001909190803563ffffffff16906020019091905050610332565b604051808060200184600019166000191681526020018367ffffffffffffffff1667ffffffffffffffff168152602001828103825285818151815260200191508051906020019080838360005b838110156101105780820151818401526020810190506100f5565b50505050905090810190601f16801561013d5780820380516001836020036101000a031916815260200191505b5094505050505060405180910390f35b341561015857600080fd5b610174600480803563ffffffff16906020019091905050610469565b005b341561018157600080fd5b61019d600480803563ffffffff1690602001909190505061064d565b604051808060200185600019166000191681526020018467ffffffffffffffff1667ffffffffffffffff1681526020018367ffffffffffffffff1667ffffffffffffffff168152602001828103825286818151815260200191508051906020019080838360005b8381101561021f578082015181840152602081019050610204565b50505050905090810190601f16801561024c5780820380516001836020036101000a031916815260200191505b509550505050505060405180910390f35b341561026857600080fd5b610284600480803563ffffffff16906020019091905050610869565b604051808263ffffffff1663ffffffff16815260200191505060405180910390f35b34156102b157600080fd5b610330600480803563ffffffff1690602001909190803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919080356000191690602001909190803567ffffffffffffffff1690602001909190505061089b565b005b61033a610ab9565b600080600080805490508663ffffffff1610151561035757600080fd5b60008663ffffffff1681548110151561036c57fe5b90600052602060002090600402016003018563ffffffff1681548110151561039057fe5b90600052602060002090600302019050806000018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156104385780601f1061040d57610100808354040283529160200191610438565b820191906000526020600020905b81548152906001019060200180831161041b57829003601f168201915b50505050509350806001015492508060020160009054906101000a900467ffffffffffffffff169150509250925092565b6000806000805490508363ffffffff1610151561048557600080fd5b60008363ffffffff1681548110151561049a57fe5b90600052602060002090600402019150600090505b81600301805490508110156106485781600301818154811015156104cf57fe5b906000526020600020906003020160020160009054906101000a900467ffffffffffffffff1667ffffffffffffffff1643141561063b57816003018181548110151561051757fe5b906000526020600020906003020160000182600001600001908054600181600116156101000203166002900461054e929190610acd565b50816003018181548110151561056057fe5b906000526020600020906003020160010154826000016001018160001916905550816003018181548110151561059257fe5b906000526020600020906003020160020160009054906101000a900467ffffffffffffffff168260000160020160006101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555081600301818154811015156105f657fe5b9060005260206000209060030201600080820160006106159190610b54565b60018201600090556002820160006101000a81549067ffffffffffffffff021916905550505b80806001019150506104af565b505050565b610655610ab9565b60008060008060008061066788610469565b60008863ffffffff1681548110151561067c57fe5b90600052602060002090600402016000019250826000018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156107275780601f106106fc57610100808354040283529160200191610727565b820191906000526020600020905b81548152906001019060200180831161070a57829003601f168201915b50505050509650826001015495508260020160009054906101000a900467ffffffffffffffff16945067ffffffffffffffff9350600091505b60008863ffffffff1681548110151561077557fe5b90600052602060002090600402016003018054905082101561085f5760008863ffffffff168154811015156107a657fe5b9060005260206000209060040201600301828154811015156107c457fe5b9060005260206000209060030201905060008160020160009054906101000a900467ffffffffffffffff1667ffffffffffffffff1611801561083157508367ffffffffffffffff168160020160009054906101000a900467ffffffffffffffff1667ffffffffffffffff16105b15610852578060020160009054906101000a900467ffffffffffffffff1693505b8180600101925050610760565b5050509193509193565b6000808263ffffffff1681548110151561087f57fe5b9060005260206000209060040201600301805490509050919050565b6108a3610b9c565b6000805490508563ffffffff161015156108bc57600080fd5b8167ffffffffffffffff16431015156108e0576108db858585856109c1565b6109ba565b606060405190810160405280858152602001846000191681526020018367ffffffffffffffff16815250905060008563ffffffff1681548110151561092157fe5b906000526020600020906004020160030180548060010182816109449190610bd1565b916000526020600020906003020160008390919091506000820151816000019080519060200190610976929190610c03565b506020820151816001019060001916905560408201518160020160006101000a81548167ffffffffffffffff021916908367ffffffffffffffff1602179055505050505b5050505050565b6000805490508463ffffffff161015156109da57600080fd5b8067ffffffffffffffff1643101515156109f357600080fd5b8260008563ffffffff16815481101515610a0957fe5b90600052602060002090600402016000016000019080519060200190610a30929190610c83565b508160008563ffffffff16815481101515610a4757fe5b906000526020600020906004020160000160010181600019169055508060008563ffffffff16815481101515610a7957fe5b906000526020600020906004020160000160020160006101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555050505050565b602060405190810160405280600081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610b065780548555610b43565b82800160010185558215610b4357600052602060002091601f016020900482015b82811115610b42578254825591600101919060010190610b27565b5b509050610b509190610d03565b5090565b50805460018160011615610100020316600290046000825580601f10610b7a5750610b99565b601f016020900490600052602060002090810190610b989190610d03565b5b50565b606060405190810160405280610bb0610d28565b815260200160008019168152602001600067ffffffffffffffff1681525090565b815481835581811511610bfe57600302816003028360005260206000209182019101610bfd9190610d3c565b5b505050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610c4457805160ff1916838001178555610c72565b82800160010185558215610c72579182015b82811115610c71578251825591602001919060010190610c56565b5b509050610c7f9190610d03565b5090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610cc457805160ff1916838001178555610cf2565b82800160010185558215610cf2579182015b82811115610cf1578251825591602001919060010190610cd6565b5b509050610cff9190610d03565b5090565b610d2591905b80821115610d21576000816000905550600101610d09565b5090565b90565b602060405190810160405280600081525090565b610d8b91905b80821115610d875760008082016000610d5b9190610b54565b60018201600090556002820160006101000a81549067ffffffffffffffff021916905550600301610d42565b5090565b905600a165627a7a72305820dd909718ba8b56961c4ba10916d1f01fff7ac0371ba7fdf688eb1e698097f4010029`
	PARAM_STORE_ABI = `[{"constant":true,"inputs":[{"name":"index","type":"uint32"},{"name":"findex","type":"uint32"}],"name":"getFutureMeta","outputs":[{"name":"Value","type":"string"},{"name":"TxHash","type":"bytes32"},{"name":"EffectBlock","type":"uint64"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"index","type":"uint32"}],"name":"applyFuture","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"index","type":"uint32"}],"name":"getCurrentMeta","outputs":[{"name":"Value","type":"string"},{"name":"TxHash","type":"bytes32"},{"name":"EffectBlock","type":"uint64"},{"name":"ExpireBlock","type":"uint64"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"index","type":"uint32"}],"name":"futureLength","outputs":[{"name":"","type":"uint32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"index","type":"uint32"},{"name":"value","type":"string"},{"name":"txhash","type":"bytes32"},{"name":"effectBlock","type":"uint64"}],"name":"addFuture","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]`
)


type ParamStore struct {
	BoundContract
	ctx *CallContext

}

type ParamMeta struct {
	Value string
	TxHash common.Hash
	EffectBlock uint64
	ExpireBlock uint64
}

func NewParamStore(ctx *CallContext, bc *BoundContract) *ParamStore {
	return &ParamStore{
		BoundContract: *bc,
		ctx: ctx,
	}
}

func (ps *ParamStore) AddFuture(pindex uint32, meta *ParamMeta) (error) {
	return ps.NoResultCall(ps.ctx, NewCallOpt(nil, "addFuture", pindex, meta.Value, meta.TxHash, meta.EffectBlock))
}

func (ps *ParamStore) ApplyFuture(pindex uint32) (error) {
	return ps.NoResultCall(ps.ctx, NewCallOpt(nil, "applyFuture", pindex))
}

func (ps *ParamStore) GetCurrentMeta(pindex uint32) (*ParamMeta, error) {
    if ret, err := ps.ResultCall(ps.ctx, func() interface{} {
		return new(ParamMeta)
	}, NewCallOpt(nil, "getCurrentMeta", pindex)); err != nil {
		return nil, err
	} else {
		return ret.(*ParamMeta), err
	}
}
func (ps *ParamStore) FutureLength(pindex uint32) (uint32, error) {
	if ret, err := ps.ResultCall(ps.ctx, func() interface{} {
		return new(uint32)
	}, NewCallOpt(nil, "futureLength", pindex)); err != nil {
		return 0, err
	} else {
		return *(ret.(*uint32)), err
	}
}
func (ps *ParamStore) GetFutureMeta(pindex uint32, findex uint32) (*ParamMeta, error) {
	if ret, err := ps.ResultCall(ps.ctx, func() interface{} {
		return new(ParamMeta)
	}, NewCallOpt(nil, "getFutureMeta", pindex, findex)); err != nil {
		return nil, err
	} else {
		return ret.(*ParamMeta), err
	}
}